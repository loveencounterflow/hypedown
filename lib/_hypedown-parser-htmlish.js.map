{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/_hypedown-parser-htmlish.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n'use strict'\n\n\n############################################################################################################\nGUY                       = require 'guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'HYPEDOWN-PARSER/HTMLISH'\n#...........................................................................................................\n{ rpr\n  inspect\n  echo\n  log     }               = GUY.trm\n#...........................................................................................................\n{ Pipeline\n  transforms  } = require 'moonriver'\nHTMLISH        = ( require 'paragate/lib/htmlish.grammar' ).new_grammar { bare: true, }\nhtmlish_sym     = Symbol 'htmlish'\n#...........................................................................................................\n{ DATOM }                 = require 'datom'\n#...........................................................................................................\n{ new_datom\n  lets\n  stamp }                = DATOM\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@Hypedown_parser_htmlish = ( clasz = Object ) => class extends clasz\n\n  #---------------------------------------------------------------------------------------------------------\n  _hd_token_from_paragate_token: ( hd_token, pg_token ) ->\n    tag_types =\n      otag:       { open: true,  close: false, }  # opening tag, `<a>`\n      ctag:       { open: false, close: true,  }  # closing tag, `</a>` or `</>`\n      ntag:       { open: true,  close: false, }  # opening tag of `<i/italic/`\n      nctag:      { open: false, close: true,  }  # closing slash of `<i/italic/`\n      stag:       { open: true,  close: true,  }  # self-closing tag, `<br/>`\n    #.......................................................................................................\n    R =\n      mode:   'tag'\n      tid:    pg_token.type\n      mk:     \"tag:???\"\n      jump:   null\n      value:  hd_token.value\n      ### TAINT must give first_lnr, last_lnr ###\n      lnr1:   hd_token.lnr1\n      x1:     hd_token.x1\n      lnr2:   hd_token.lnr2\n      x2:     hd_token.x2\n      x:\n        atrs:   pg_token.atrs\n        id:     pg_token.id\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  $parse_htmlish: ->\n    p = new Pipeline()\n    p.push @$_collect_tag_tokens()\n    p.push @$_parse_tag_source()\n    return p\n\n  #---------------------------------------------------------------------------------------------------------\n  $_collect_tag_tokens: =>\n    position  = null\n    collector = null\n    return _collect_tag_tokens = ( d, send ) =>\n      if d.tid is '$border'\n        if d.x.nxt is 'tag'\n          send d\n          collector = []\n          position  = GUY.props.pick_with_fallback d, null, 'lnr1', 'x1'\n        else if d.x.prv is 'tag'\n          position  = { position..., ( GUY.props.pick_with_fallback d, null, 'lnr2', 'x2' )..., }\n          debug '^345^', position, ( t.value for t in collector ).join '|'\n          ### TAINT use API ###\n          token =\n            mode:       'raw-html'\n            tid:        'tag'\n            mk:         'raw-html:tag'\n            jump:       null\n            value:      ( t.value for t in collector ).join ''\n            # x:          null\n            # $stamped:   null\n            # name:       null\n            lnr1:       position.lnr1\n            x1:         position.x1\n            lnr2:       position.lnr2\n            x2:         position.x2\n            $key:       '^whatever'\n            $:          '^parse_htmlish@1^'\n          #.................................................................................................\n          send ( stamp t ) for t in collector\n          collector = null\n          send token\n          send d\n      else if d.mode is 'tag'\n        collector.push d\n      else\n        send d\n      # urge '^parse_htmlish@1^', d\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  $_parse_tag_source: =>\n    return _parse_tag_source = ( d, send ) =>\n      return send d unless d.mk is 'raw-html:tag'\n      send stamp d\n      unless ( pg_tokens = HTMLISH.parse d.value ).length is 1\n        ### TAINT use API to create token ###\n        return send { mode: 'tag', tid: '$error', } ### expected single token, got #{rpr htmlish} ###\n      [ pg_token ]           = GUY.lft.thaw pg_tokens\n      send @_hd_token_from_paragate_token d, pg_token\n      return null\n\n\n#-----------------------------------------------------------------------------------------------------------\nnew_parser = ( lexer ) ->\n\n  #.........................................................................................................\n  $_hd_token_from_paragate_token = ->\n  #.........................................................................................................\n  $parse_htmlish_tag  = ->\n    collector   = []\n    within_tag  = false\n    sp          = new Pipeline()\n    sp.push transforms.$window { min: 0, max: +1, empty: null, }\n    sp.push parse_htmlish_tag = ( [ d, nxt, ], send ) ->\n      #.....................................................................................................\n      if within_tag\n        collector.push d\n        # debug '^parse_htmlish_tag@1^', d\n        if d.jump is 'plain' ### TAINT magic number ###\n          within_tag  = false\n          $source     = ( e.value for e from collector ).join ''\n          $collector  = [ collector..., ]\n          send stamp collector.shift() while collector.length > 0\n          htmlish     = HTMLISH.parse $source\n          # H.tabulate '^78^', htmlish\n          # debug '^78^', rpr $source\n          # info '^78^', x for x in htmlish\n          unless htmlish.length is 1\n            ### TAINT use API to create token ###\n            # throw new Error \"^34345^ expected single token, got #{rpr htmlish}\"\n            return send { mode: 'tag', tid: '$error', }\n          [ htmlish ]           = GUY.lft.thaw htmlish\n          htmlish[htmlish_sym]  = true\n          htmlish.$collector    = $collector\n          htmlish.$source       = $source\n          send htmlish\n        return null\n      #.....................................................................................................\n      else\n        return send d unless nxt?.mk.startsWith 'tag:'\n        within_tag = true\n        collector.push d\n      #.....................................................................................................\n      return null\n    sp.push $_hd_token_from_paragate_token()\n    return sp\n  #.........................................................................................................\n  p             = new Pipeline()\n  p.lexer       = lexer\n  p.push $tokenize p\n  p.push $parse_htmlish_tag()\n  # p.push show = ( d ) -> urge '^parser@1^', d\n  # debug '^43^', p\n  return p\n"
  ]
}